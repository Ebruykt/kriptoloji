<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <title>Klasik Åžifrelemeler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    *{box-sizing:border-box;}
    body{
      margin:0; padding:0;
      font-family:Segoe UI, Roboto, Arial, sans-serif;
      color:#1f2937;
      background:linear-gradient(to right, #FFB6C1, #E0BBE4, #ADD8E6);
      min-height:100vh;
      display:flex; justify-content:center; align-items:flex-start;
    }
    .container{
      width:92%; max-width:760px;
      margin:40px 0;
      background:linear-gradient(180deg,#ffffff,#f8fafc);
      border:1px solid rgba(59, 130, 246, 0.2);
      border-radius:16px;
      padding:24px 22px 28px;
      box-shadow:0 12px 30px rgba(59, 130, 246, 0.1), 0 4px 12px rgba(236, 72, 153, 0.08);
    }
    h1{
      text-align:center; margin:4px 0 18px;
      font-weight:800; letter-spacing:.2px;
      background:linear-gradient(90deg,#FFB6C1,#E0BBE4,#ADD8E6);
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    label{Display:block; font-weight:600; margin-top:12px; color:#475569;}
    select,input,textarea{
      width:100%; margin-top:6px;
      padding:12px 12px; font-size:15px; color:#1f2937;
      background:#ffffff;
      border:1px solid #cbd5e1; border-radius:12px;
      outline:none; transition:.18s ease;
    }
    select:focus,input:focus,textarea:focus{
      border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59, 130, 246, 0.2);
      background:#ffffff;
    }
    textarea{resize:vertical;}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
    @media(max-width:640px){.row{grid-template-columns:1fr;}}

    .btn{
      width:100%; padding:12px; border:none; border-radius:12px;
      font-size:16px; font-weight:700; cursor:pointer; color:#ffffff;
      transition:transform .06s ease, filter .15s ease;
    }
    .btn:active{transform:translateY(1px)}
    .encrypt{background:linear-gradient(135deg,#3b82f6,#8b5cf6);}
    .decrypt{background:linear-gradient(135deg,#ec4899,#f472b6);}
    .encrypt:hover,.decrypt:hover{filter:brightness(1.1);}

    pre{
      background:#f8fafc; border:1px dashed #cbd5e1;
      border-radius:12px; padding:12px; min-height:68px; white-space:pre-wrap;
      color:#1f2937;
    }
    h3{
      color:#334155;
      margin:18px 4px 8px;
    }
    .heart{
      position:fixed;
      font-size:20px;
      color:#FFB6C1;
      pointer-events:none;
      z-index:9999;
      animation:floatUp 3s ease-out forwards;
    }
    @keyframes floatUp{
      0%{
        opacity:1;
        transform:translateY(0) scale(1);
      }
      100%{
        opacity:0;
        transform:translateY(-200px) scale(1.5);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Klasik Åžifrelemeler</h1>

    <label for="method">Algoritma SeÃ§in</label>
    <select id="method"></select>

    <div id="params" class="row"></div>

    <label for="text">Metin</label>
    <textarea id="text" rows="5" placeholder="Åžifrelenecek veya Ã§Ã¶zÃ¼lecek metni yazÄ±n..."></textarea>

    <div class="row" style="margin-top:14px;">
      <button class="btn encrypt" onclick="callApi('encrypt')">ðŸ”’ Åžifrele</button>
      <button class="btn decrypt" onclick="callApi('decrypt')">ðŸ”“ Ã‡Ã¶z</button>
    </div>

    <h3 style="margin:18px 4px 8px;">SonuÃ§</h3>
    <pre id="out"></pre>
  </div>

<script>
const PARAMS = {
  caesar: [{key:"k",label:"KaydÄ±rma (k)",type:"number",value:3}],
  vigenere: [{key:"key",label:"Anahtar",type:"text",value:"key"}],
  substitution: [{key:"mapping",label:"26 Harf Harita",type:"text",value:"qwertyuiopasdfghjklzxcvbnm"}],
  affine: [
    {key:"a",label:"a (gcd(a,26)=1)",type:"number",value:5},
    {key:"b",label:"b",type:"number",value:8}
  ],
  // Yeni eklemeler: hill ve railfence iÃ§in parametre tanÄ±mlarÄ±
  hill: [{key:"key",label:"Anahtar (4 veya 9 harf)",type:"text",value:"GYBN"}],
  railfence: [{key:"rails",label:"Ray SayÄ±sÄ±",type:"number",value:3}]
};

function createHeart(x, y){
  const heart = document.createElement('div');
  heart.className = 'heart';
  heart.textContent = 'ðŸ’–';
  heart.style.left = x + 'px';
  heart.style.top = y + 'px';
  document.body.appendChild(heart);
  setTimeout(() => heart.remove(), 3000);
}

async function loadAlgos(){
  const res = await fetch('/api/algorithms');
  const algos = await res.json();
  const sel = document.getElementById('method');
  sel.innerHTML = algos.map(a=>`<option>${a}</option>`).join('');
  sel.onchange = renderParams;
  renderParams();
  
  const textarea = document.getElementById('text');
  textarea.addEventListener('input', function(e){
    const text = e.target.value.toLowerCase();
    if(text.includes('hayrusss')){
      const rect = textarea.getBoundingClientRect();
      for(let i = 0; i < 10; i++){
        setTimeout(() => {
          const x = rect.left + Math.random() * rect.width;
          const y = rect.top + Math.random() * rect.height;
          createHeart(x, y);
        }, i * 100);
      }
    }
  });
}
function renderParams(){
  const m = document.getElementById('method').value;
  const box = document.getElementById('params');
  const defs = PARAMS[m]||[];
  box.innerHTML = defs.map(p=>`
    <div>
      <label>${p.label}</label>
      <input id="p-${p.key}" type="${p.type}" value="${p.value??''}">
    </div>`).join('');
}
async function callApi(kind){
  const method = document.getElementById('method').value;
  const text = document.getElementById('text').value;
  
  // Ã–zel kontrol: melisa yazÄ±ldÄ±ÄŸÄ±nda Ã¶zel mesaj gÃ¶ster
  if(text.toLowerCase().includes('melisa')){
    document.getElementById('out').textContent = 'melisa ðŸ’– rÃ¼ÅŸtÃ¼';
    return;
  }
  
  const defs = PARAMS[method]||[];
  const options = {};
  defs.forEach(p => options[p.key] = document.getElementById('p-'+p.key)?.value);
  const res = await fetch('/api/'+kind, {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({method, text, options})
  });
  const js = await res.json();
  document.getElementById('out').textContent = js.result || ("Hata: " + js.error);
}
loadAlgos();
</script>
</body>
</html>
